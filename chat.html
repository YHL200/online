<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <!-- jQuery静态库。-->
    <script src="http://172.18.0.196/jquery-3.2.1.min.js"></script>


    </head>

    <style type="text/css">

    </style>
    <body>

   <h4><p id="message">小杨与小林的对话：</p></h4>
   选择身份：<input type="radio" name="sex" value="小杨" checked>小杨
    <input type="radio" name="sex" value="小林">小林
    <br/>
    <div id="show_message">
    </div>
    <input type="text"    id="ck" name="in"/><br/><br/>
    <input type="button" id="ckq" value="发送">

    </body>
    </html>

    <script type="text/javascript">

        $(document).ready(function (){
            function getdata(id) {
                id = id || 0;
                $.get("getdata.php?id="+id,function (data) {
                    if(data){
                        var message = $("#show_message").html();//旧的数据
                        var len = data.length;
                        for(var i=0;i<=len;i++){
                            message += "<p>"+ data[i].username + "：" + data[i].message+"</p>";
                            $("#show_message").html(message);
                        }
                    }
                    setTimeout(function () {
                        alert(data[i].messageID);
                        getdata(data[i].messageID);
                    },500);
                });
            }

            //点击发送按钮触发函数
            $("#ckq").click(function(e){
                    var obj=$("#ck");
                    var user = $('input:radio:checked').val();
                    $.ajax({
                        url: "chat.php",
                        type: "post",
                        async: false,
                        data: {"in":obj.val(),"username":user}
                    });
                    $("#ck").val("");
                    getdata();
            });
        })

    </script>

